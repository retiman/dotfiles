set nocompatible
set clipboard=unnamed
set fileencoding=utf-8
set termencoding=utf-8
set autoindent
set background=dark
set backspace=indent,eol,start
set complete=.,w,b,t,i
set completeopt=longest,menuone
set copyindent
set expandtab
set fileformat=unix
set fillchars=stl:\ ,stlnc:\ 
set gdefault
set guioptions+=c
set hidden
set history=50
set hlsearch
set incsearch
set ignorecase
set indentexpr=
set infercase
set laststatus=2
set lazyredraw
set listchars=tab:│\ ,trail:·
set modelines=0
set nobackup
set noerrorbells
set nofoldenable
set noswapfile
set novisualbell
set number
set pastetoggle=<F1>
set ruler
set selection=inclusive
set selectmode=mouse
set shiftwidth=2
set shiftround
set showcmd
set showmode
set showmatch
set smartcase
set smartindent
set smarttab
set softtabstop=2
set t_Co=256
set t_vb=
set tabstop=2
set title
set ttyfast
set wildmenu
set wildchar=<tab>
set wildignore=*.jpg,*.png,*.gif,*/.git/*,*/.hg/*,*/.svn/*,*.swp,*.swo,*~
set wildignore+=*.class,*.jar,*/target/*,*/.idea/*,*.ipr,*.iml
set wildignore+=*.o,*.obj,*.bak,*.exe
set wildmode=list:longest

let mapleader=','
let g:ctrlp_map='<c-t>'
let g:ctrlp_working_path_mode='r'
let g:Powerline_symbols='compatible'
let g:ackprg='ack -H --nocolor --nogroup --column'
let g:buftabs_only_basename=1
let g:quickfix_is_open=0

call pathogen#infect()

syntax on
filetype plugin indent on
colorscheme mango

" Functions
function! ToggleColorColumn()
  if empty(&colorcolumn)
    if empty(&textwidth)
      setlocal colorcolumn=80
    else
      setlocal colorcolumn=+1
    endif
  else
    echo "colorcolumn="
    setlocal colorcolumn=
  endif
endfunction

function! QuickfixToggle()
    if g:quickfix_is_open
        cclose
        let g:quickfix_is_open=0
    else
        copen
        let g:quickfix_is_open=1
    endif
endfunction

" Mappings
"   Toggle quicklist
map <silent> <F2> :call QuickfixToggle()<cr>
"   Toggle highlighting of really long lines
map <silent> <F5>
      \ :if exists('w:long_line_match') <Bar>
      \   silent! call matchdelete(w:long_line_match) <Bar>
      \   unlet w:long_line_match <Bar>
      \ elseif &textwidth > 0 <Bar>
      \   let w:long_line_match = matchadd('OverColLimit', '\%>'.&tw.'v.\+', -1) <Bar>
      \ else <Bar>
      \   let w:long_line_match = matchadd('OverColLimit', '\%>80v.\+', -1) <Bar>
      \ endif<CR>
"   Remove all trailing whitespace
map <silent> <F6> :let _s=@/<Bar>:%s/\s\+$//e<Bar>:let @/=_s<Bar>:nohl<cr>
"   Open/close the taglist
map <silent> <F7> :TlistToggle<cr>

" Command mode mappings (same as cnoremap)
cmap w!! w !sudo tee % >/dev/null

" Normal mode mappings (same as nnoremap)
nmap ; :
nmap / /\v
nmap j gj
nmap k gk
nmap J <nop>
nmap K <nop>
nmap <tab> %
nmap <c-g> <c-]>
nmap <c-h> <c-w>h
nmap <c-j> <c-w>j
nmap <c-k> <c-w>k
nmap <c-l> <c-w>l
nmap <c-n> :bnext<cr>
nmap <c-p> :bprev<cr>
nmap <leader><tab> :Scratch<cr>
nmap <leader>a :Ack<space>
nmap <leader>b :1pop<cr>
nmap <leader>cd :cd %:p:h<cr>:pwd<cr>
nmap <leader>d :bd<cr>:syn on<cr>
nmap <leader>e :set expandtab! list!<cr>
nmap <leader>gb :Gblame<cr>
nmap <leader>gd :Gdiff<cr>
nmap <leader>gc :Gcommit<cr>
nmap <leader>gl :Glog<cr>
nmap <leader>gs :Gstatus<cr>
nmap <leader>i :set list!<cr>
nmap <leader>j <c-]><cr>
nmap <leader>l :call QuickfixToggle()<cr>
nmap <leader>pp :r!xsel -p<cr>
nmap <leader>ps :r!xsel -s<cr>
nmap <leader>pb :r!xsel -b<cr>
nmap <leader>r :res<cr>
" nmap <leader>s (used by slime.vim)
nmap <silent> <leader>t :!ctags -R * &<cr><cr>
nmap <leader>u :set number!<cr>
nmap <leader>v V`]
nmap <leader>q :q!<cr>
" nmap <leader>x (used by slime.vim)
nmap <silent> <leader>yy :w !xsel -i -b<cr><cr>
nmap <leader>= <c-w>=<cr>
nmap <leader>/ :set hlsearch!<cr>

" Visual mode mappings (same as vnoremap)
vmap / /\v
vmap j gj
vmap k gk
vmap <tab> %
vmap J <nop>
vmap K <nop>
vmap <leader>pp :r!xsel -p<cr>
vmap <leader>ps :r!xsel -s<cr>
vmap <leader>pb :r!xsel -b<cr>
vmap <silent> <leader>yy :w !xsel -i -b<cr><cr>

" Insert mode mappings (same as inoremap)
"   When an auto-complete menu is presented, the first item is selected by
"   default
imap <expr> <c-n> pumvisible() ? '<c-n>' :
    \ '<C-n><C-r>=pumvisible() ? "\<lt>Down>" : ""<cr>'
"   Simulates <c-x><c-o> to bring up omni-complete, and simulates <c-n><c-p>
"   to remove the longest common text
imap <expr> <m-,> pumvisible() ? '<c-n>' :
    \ '<C-x><C-o><C-n><C-p><C-r>=pumvisible() ? "\<lt>Down>" : ""<CR>'
"   Maps ctrl+space to autocomplete, just like in your favorite IDEs
imap <nul> <c-x><c-u><c-p>

" Highlight really long lines
highlight OverColLimit ctermbg=darkblue

" Highlight all trailing whitespace
au BufWinEnter * let w:m2=matchadd('ErrorMsg', '\s\+$', -1)

" Project specific settings
set secure
au BufEnter,BufReadPost * silent! source ./project.vim
